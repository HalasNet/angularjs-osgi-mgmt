<!DOCTYPE html>
<html>
<head>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- ======================================================================= -->
	<!--           EXTERNAL LIBRARIES AND STYLESHEETS                            -->
	<!-- ======================================================================= -->

	<!-- jQuery  -->
	<script src="libs/jquery_1.10.2/jquery.js"></script>

	<!-- AngularJS -->
	<script src="libs/angularjs_1.2.0-rc.3/angular.js"></script>
	<script  src="libs/angularjs_1.2.0-rc.3/angular-animate.js"></script>
	<script  src="libs/angularjs_1.2.0-rc.3/angular-route.js"></script>

	<!-- External Fonts -->
	<link href='libs/googlefonts/googlefonts.css' rel='stylesheet' type='text/css'>
	<link href="libs/font-awesome_4.0.3/css/font-awesome.css" rel="stylesheet">

	<!-- Twitter Bootstrap -->
	<link href="libs/bootstrap_3.0.0/css/bootstrap.css" rel="stylesheet" media="screen">

	<!-- Bootstrap theme -->
	<link href="libs/bootstrap_3.0.0/css/bootstrap-theme.min.css" rel="stylesheet" >

	<!-- AngularJS Animations from https://github.com/Augus/ngAnimate/ -->
	<link rel="stylesheet" type="text/css" href="css/animations.css" />

	<!-- ======================================================================= -->
	<!--           APPLICATION FRAMEWORK                                         -->
	<!-- ======================================================================= -->
	<script type="text/javascript" src="platform/ui/components.js"></script>
	<script type="text/javascript" src="platform/ui/client.js"></script>
	<script type="text/javascript"  src="platform/perspectivemanager/perspectivemanager.js"></script>

	<!-- ======================================================================= -->
	<!--           "DYNAMICAL" BOOTSTRAP OF REQUIRED MODULES                     -->
	<!-- ======================================================================= -->
	<script type="text/javascript">

		console.log("LOADING CLIENT CONFIGURATION");
		$.getJSON( "client-config.json", function( data ) {

			// Required Platform/Framework modules
			var PLATFORM_MODULES = [
				'ngRoute',
				'ngAnimate',
				'Platform.Ui.Client',
				'Platform.Ui.Components',
				'Platform.PerspectiveManager'
			];

			// Holds a list of promises that download (and execute) the scripts defined in Client configuration
			var SCRIPTS = [];

			// All modules loaded from client configuration
			var MODULES = [];

			// Load all modules defined in client configuration
			$.each(data.modules, function(moduleId, module) {
				MODULES.push({'id':moduleId,'basedir': module.basedir});

				var basedir = module.basedir;

				// load and execute all defined scripts for that module
				var scripts = module.scripts.split(",");
				for (var i=0;i<scripts.length;i++) {
					var script = basedir + '/' + scripts[i].trim();
					var g = $.getScript(script);
					SCRIPTS.push(g);
				}
			});


			// Wait for downloading and executing all scripts defined in client configuration
			$.when.apply($, SCRIPTS).done(function() {

				// Bootstrap Angular...
				console.log("CLIENT CONFIG LOADED. BOOTSTRAPPING ANGULAR");

				angular.element(document).ready(function() {
					console.log("Bootstrap Platform.MainApp")
					var allModules = PLATFORM_MODULES;

					// Prepare Modules
					$.each(MODULES, function(id, module) {
						// add module to list of all modules
						allModules.push(module.id);

						// create a injectable constant with the configured basedir
						var constantName = module.id.replace(/\./g,'_').toUpperCase()+"_BASEDIR";

						angular.module(module.id).constant(constantName, module.basedir);
					});

					// Create 'overall application'
					angular.module('Platform.MainApp', allModules);

					// Bootstrap AngularJs
					angular.bootstrap(document, ['Platform.MainApp']);
				})
			})
		});

	</script>


	<!-- Our own styles -->
	<link rel="stylesheet" type="text/css" href="css/styles.css">

</head>

<body data-ng-controller="AppController">
	<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
		<div class="container">

			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand osgimgmt-navbar-brand osgimgmt-brand" href="#">OSGi Management</a>
			</div>

			<div class="collapse navbar-collapse navbar-ex1-collapse">
				<ul class="nav navbar-nav" data-ng-controller="NavBarController">
					<li data-ng-class="{'active':isActive('/' + part.path)}" data-ng-repeat="part in parts"><a href="/#/{{part.path}}">{{part.title}}</a></li>
				</ul>
			</div>
		</div>
	</nav>



	<div class="container">
		<div ng-view></div>
	</div>

	<!-- Bootstrap Javascript -->
	<script src="libs/bootstrap_3.0.0/js/bootstrap.min.js"></script>

</body>
</html>